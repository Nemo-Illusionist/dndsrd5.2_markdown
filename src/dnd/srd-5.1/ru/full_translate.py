#!/usr/bin/env python3
"""
Complete translation of 10_Spells.md from EN to RU.
Keeps the intro (lines 0-228) from the already-translated RU file.
Translates lines 229+ from EN original with comprehensive body translation.
"""
import re, sys
sys.path.insert(0, "/Users/petrradilov/Documents/srd/dndsrd5.2_markdown/src/dnd/srd-5.1/ru")
from line_map_ext import LINE_MAP_EXT

EN_FILE = "/Users/petrradilov/Documents/srd/dndsrd5.2_markdown/src/dnd/srd-5.1/en/10_Spells.md"
RU_FILE = "/Users/petrradilov/Documents/srd/dndsrd5.2_markdown/src/dnd/srd-5.1/ru/10_Spells.md"

with open(EN_FILE, "r", encoding="utf-8") as f:
    en_lines = f.read().split('\n')
with open(RU_FILE, "r", encoding="utf-8") as f:
    ru_lines = f.read().split('\n')

N = len(en_lines)

# ============================================================
# COMPLETE LINE-BY-LINE TRANSLATION MAP
# Maps EN body text lines (line numbers) to their full RU translations.
# This is the most reliable approach for literary quality.
# ============================================================
LINE_MAP = {
    # === Acid Splash ===
    242: "Вы швыряете пузырёк кислоты. Выберите одно существо, которое видите в пределах дистанции, или два существа, которые видите в пределах дистанции и которые находятся в пределах 5 футов друг от друга. Цель должна преуспеть в спасброске Ловкости, иначе она получит 1к6 урона кислотой.",
    244: "**_Усиление заговора._** Урон этого заклинания увеличивается на 1к6, когда вы достигаете 5-го уровня (2к6), 11-го уровня (3к6) и 17-го уровня (4к6).",

    # === Chill Touch ===
    258: "Вы создаёте призрачную скелетную руку в пространстве существа в пределах дистанции. Совершите дальнобойную атаку заклинанием по этому существу, чтобы поразить его могильным холодом. При попадании цель получает 1к8 некротического урона и не может восстанавливать хиты до начала вашего следующего хода. До этого момента рука цепляется за цель.",
    260: "Если вы попадёте по нежити, она также совершает броски атаки по вам с помехой до конца вашего следующего хода.",
    262: "**_Усиление заговора._** Урон этого заклинания увеличивается на 1к8, когда вы достигаете 5-го уровня (2к8), 11-го уровня (3к8) и 17-го уровня (4к8).",

    # === Dancing Lights ===
    276: "Вы создаёте до четырёх огней размером с факел в пределах дистанции, придавая им вид факелов, фонарей или светящихся сфер, которые парят в воздухе на время действия заклинания. Вы также можете объединить четыре огня в одну светящуюся, смутно похожую на гуманоида форму Среднего размера. В любой из выбранных форм каждый огонь излучает тусклый свет в радиусе 10 футов.",
    278: "Бонусным действием в свой ход вы можете переместить огни на расстояние до 60 футов в новое место в пределах дистанции. Каждый огонь должен находиться в пределах 20 футов от другого огня, созданного этим заклинанием, и огонь гаснет, если выходит за пределы дистанции заклинания.",

    # === Druidcraft ===
    292: "Шепча духам природы, вы создаёте один из следующих эффектов в пределах дистанции:",
    294: "- Вы создаёте крошечный безвредный сенсорный эффект, предсказывающий погоду в вашем местонахождении на следующие 24 часа. Эффект может проявиться в виде золотой сферы (ясная погода), облака (дождь), падающих снежинок (снег) и так далее. Этот эффект длится 1 раунд.",
    295: "- Вы мгновенно заставляете цветок распуститься, семенную коробочку раскрыться или листовую почку набухнуть.",
    296: "- Вы создаёте мгновенный безвредный сенсорный эффект, например падающие листья, порыв ветра, звук маленького животного или слабый запах скунса. Эффект должен помещаться в 5-футовый куб.",
    297: "- Вы мгновенно зажигаете или тушите свечу, факел или маленький костёр.",

    # === Eldritch Blast ===
    311: "Луч потрескивающей энергии устремляется к существу в пределах дистанции. Совершите дальнобойную атаку заклинанием по цели. При попадании цель получает 1к10 урона силовым полем.",
    313: "**_Усиление заговора._** Заклинание создаёт более одного луча, когда вы достигаете более высоких уровней: два луча на 5-м уровне, три луча на 11-м уровне и четыре луча на 17-м уровне. Вы можете направить лучи в одну и ту же цель или в разные. Совершите отдельный бросок атаки для каждого луча.",

    # === Fire Bolt ===
    327: "Вы швыряете сгусток пламени в существо или предмет в пределах дистанции. Совершите дальнобойную атаку заклинанием по цели. При попадании цель получает 1к10 урона огнём. Горючий предмет, поражённый этим заклинанием, воспламеняется, если его никто не несёт и не носит.",
    329: "**_Усиление заговора._** Урон этого заклинания увеличивается на 1к10, когда вы достигаете 5-го уровня (2к10), 11-го уровня (3к10) и 17-го уровня (4к10).",

    # === Guidance ===
    343: "Вы касаетесь одного согласного существа. Один раз до окончания заклинания цель может бросить к4 и добавить результат к одной проверке характеристики по своему выбору. Она может бросить кость до или после совершения проверки характеристики. После этого заклинание оканчивается.",

    # === Light ===
    357: "Вы касаетесь одного предмета, размеры которого ни по одному измерению не превышают 10 футов. Пока заклинание не закончится, предмет излучает яркий свет в радиусе 20 футов и тусклый свет в дополнительном радиусе 20 футов. Вы можете выбрать цвет свечения. Полное укрытие предмета чем-то непрозрачным блокирует свет. Заклинание оканчивается, если вы сотворите его снова или отпустите действием.",
    359: "Если вы нацеливаете заклинание на предмет, который несёт или носит враждебное существо, это существо должно преуспеть в спасброске Ловкости, чтобы избежать заклинания.",

    # === Mage Hand ===
    373: "Призрачная парящая рука появляется в точке по вашему выбору в пределах дистанции. Рука существует на время действия заклинания или пока вы не отпустите её действием. Рука исчезает, если окажется далее 30 футов от вас или если вы сотворите это заклинание снова.",
    375: "Вы можете использовать своё действие для управления рукой. Вы можете использовать руку для манипуляций с предметом, открывания незапертой двери или контейнера, убирания или извлечения предмета из открытого контейнера или выливания содержимого сосуда. Вы можете перемещать руку на расстояние до 30 футов каждый раз, когда используете её.",
    377: "Рука не может атаковать, активировать магические предметы или нести более 10 фунтов.",

    # === Mending ===
    391: "Это заклинание восстанавливает единичный разрыв или трещину в предмете, которого вы касаетесь, например сломанное звено цепи, две половинки сломанного ключа, порванный плащ или протекающий бурдюк. Если разрыв или трещина не превышает 1 фута ни по одному измерению, вы чините предмет, не оставляя следов бывшего повреждения.",
    393: "Это заклинание может физически восстановить магический предмет или конструкт, но не может вернуть магию такому предмету.",

    # === Message ===
    407: "Вы указываете пальцем на существо в пределах дистанции и шёпотом произносите послание. Цель (и только цель) слышит послание и может ответить шёпотом, который можете услышать только вы.",
    409: "Вы можете сотворять это заклинание сквозь твёрдые объекты, если знакомы с целью и знаете, что она находится за преградой. Магическая тишина, 1 фут камня, 1 дюйм обычного металла, тонкий лист свинца или 3 фута дерева блокируют заклинание. Заклинание не обязано следовать по прямой линии и может свободно огибать углы и проходить через отверстия.",

    # === Minor Illusion ===
    423: "Вы создаёте звук или образ предмета в пределах дистанции, который существует на время действия заклинания. Иллюзия также оканчивается, если вы отпустите её действием или сотворите это заклинание снова.",
    425: "Если вы создаёте звук, его громкость может варьироваться от шёпота до крика. Это может быть ваш голос, чей-то ещё голос, рык льва, бой барабанов или любой другой звук по вашему выбору. Звук продолжается без изменений на протяжении всей длительности, или вы можете издавать отдельные звуки в разное время, пока заклинание не закончится.",
    427: "Если вы создаёте образ предмета — например, стула, грязных следов или маленького сундука — он должен быть не больше 5-футового куба. Образ не может создавать звук, свет, запах или какой-либо другой сенсорный эффект. Физическое взаимодействие с образом раскрывает его иллюзорность, потому что сквозь него можно пройти.",
    429: "Если существо использует своё действие для изучения звука или образа, оно может определить, что это иллюзия, совершив успешную проверку Интеллекта (Расследование) против СЛ спасброска от ваших заклинаний. Если существо распознаёт иллюзию, она становится для него блёклой.",

    # === Poison Spray ===
    443: "Вы протягиваете руку к существу, которое видите в пределах дистанции, и выпускаете облачко ядовитого газа из ладони. Существо должно преуспеть в спасброске Телосложения, иначе оно получит 1к12 урона ядом.",
    445: "**_Усиление заговора._** Урон этого заклинания увеличивается на 1к12, когда вы достигаете 5-го уровня (2к12), 11-го уровня (3к12) и 17-го уровня (4к12).",

    # === Prestidigitation ===
    459: "Это заклинание — незначительный магический фокус, который начинающие заклинатели используют для практики. Вы создаёте один из следующих магических эффектов в пределах дистанции:",
    461: "- Вы создаёте мгновенный безвредный сенсорный эффект, например сноп искр, порыв ветра, тихие музыкальные ноты или странный запах.",
    462: "- Вы мгновенно зажигаете или тушите свечу, факел или маленький костёр.",
    463: "- Вы мгновенно очищаете или пачкаете предмет размером не более 1 кубического фута.",
    464: "- Вы охлаждаете, нагреваете или придаёте вкус до 1 кубического фута неживого материала на 1 час.",
    465: "- Вы создаёте цветное пятно, маленькую метку или символ на предмете или поверхности на 1 час.",
    466: "- Вы создаёте немагическую безделушку или иллюзорный образ, помещающийся в вашей руке и существующий до конца вашего следующего хода.",
    468: "Если вы сотворяете это заклинание несколько раз, у вас может быть до трёх его немгновенных эффектов одновременно, и вы можете отпустить такой эффект действием.",

    # === Produce Flame ===
    482: "В вашей руке появляется мерцающее пламя. Пламя остаётся в ней на время действия заклинания и не причиняет вреда ни вам, ни вашему снаряжению. Пламя излучает яркий свет в радиусе 10 футов и тусклый свет в дополнительном радиусе 10 футов. Заклинание оканчивается, если вы отпустите его действием или сотворите его снова.",
    484: "Вы также можете атаковать пламенем, хотя это оканчивает заклинание. Когда вы сотворяете это заклинание или действием в более поздний ход, вы можете метнуть пламя в существо, находящееся в пределах 30 футов от вас. Совершите дальнобойную атаку заклинанием. При попадании цель получает 1к8 урона огнём.",
    486: "**_Усиление заговора._** Урон этого заклинания увеличивается на 1к8, когда вы достигаете 5-го уровня (2к8), 11-го уровня (3к8) и 17-го уровня (4к8).",

    # === Ray of Frost ===
    500: "Морозный луч голубовато-белого света устремляется к существу в пределах дистанции. Совершите дальнобойную атаку заклинанием по цели. При попадании она получает 1к8 урона холодом, и её скорость уменьшается на 10 футов до начала вашего следующего хода.",
    502: "**_Усиление заговора._** Урон этого заклинания увеличивается на 1к8, когда вы достигаете 5-го уровня (2к8), 11-го уровня (3к8) и 17-го уровня (4к8).",

    # === Resistance ===
    516: "Вы касаетесь одного согласного существа. Один раз до окончания заклинания цель может бросить к4 и добавить результат к одному спасброску по своему выбору. Она может бросить кость до или после совершения спасброска. После этого заклинание оканчивается.",

    # === Sacred Flame ===
    530: "Пламенное сияние нисходит на существо, которое вы видите в пределах дистанции. Цель должна преуспеть в спасброске Ловкости, иначе она получит 1к8 урона излучением. Цель не получает выгоды от укрытия при этом спасброске.",
    532: "**_Усиление заговора._** Урон этого заклинания увеличивается на 1к8, когда вы достигаете 5-го уровня (2к8), 11-го уровня (3к8) и 17-го уровня (4к8).",

    # === Shillelagh ===
    546: "Дерево дубинки или боевого посоха, которые вы держите, наполняется силой природы. На время действия заклинания вы можете использовать свою базовую характеристику заклинателя вместо Силы для бросков атаки и урона рукопашных атак этим оружием, и кость урона оружия становится к8. Оружие также становится магическим, если не было таковым. Заклинание оканчивается, если вы сотворите его снова или выпустите оружие из рук.",

    # === Shocking Grasp ===
    560: "Из вашей руки бьёт молния, ударяя существо, которое вы пытаетесь коснуться. Совершите рукопашную атаку заклинанием по цели. Вы совершаете бросок атаки с преимуществом, если цель носит доспех из металла. При попадании цель получает 1к8 урона электричеством и не может совершать реакции до начала своего следующего хода.",
    562: "**_Усиление заговора._** Урон этого заклинания увеличивается на 1к8, когда вы достигаете 5-го уровня (2к8), 11-го уровня (3к8) и 17-го уровня (4к8).",

    # === Spare the Dying ===
    576: "Вы касаетесь живого существа, у которого 0 хитов. Существо становится стабилизированным. Это заклинание не действует на нежить и конструктов.",

    # === Thaumaturgy ===
    590: "Вы проявляете малое чудо, знак сверхъестественной силы, в пределах дистанции. Вы создаёте один из следующих магических эффектов в пределах дистанции:",
    592: "- Ваш голос звучит в три раза громче обычного в течение 1 минуты.",
    593: "- Вы заставляете пламя мерцать, ярче гореть, тускнеть или менять цвет на 1 минуту.",
    594: "- Вы вызываете безвредную дрожь земли на 1 минуту.",
    595: "- Вы создаёте мгновенный звук, исходящий из точки по вашему выбору в пределах дистанции, например раскат грома, крик ворона или зловещий шёпот.",
    596: "- Вы мгновенно заставляете незапертую дверь или окно распахнуться или захлопнуться.",
    597: "- Вы изменяете вид своих глаз на 1 минуту. Если вы сотворяете это заклинание несколько раз, у вас может быть до трёх его минутных эффектов одновременно, и вы можете отпустить такой эффект действием.",

    # === True Strike ===
    611: "Вы протягиваете руку и указываете пальцем на цель в пределах дистанции. Ваша магия даёт вам краткое озарение о защите цели. В свой следующий ход вы получаете преимущество на первый бросок атаки по цели, при условии, что это заклинание к тому моменту ещё не закончилось.",

    # === Vicious Mockery ===
    625: "Вы обрушиваете на существо, которое видите в пределах дистанции, поток оскорблений, пронизанных тонкими чарами. Если цель слышит вас (хотя ей и не обязательно вас понимать), она должна преуспеть в спасброске Мудрости, иначе получит 1к4 психического урона и совершит следующий бросок атаки до конца своего следующего хода с помехой.",
    627: "**_Усиление заговора._** Урон этого заклинания увеличивается на 1к4, когда вы достигаете 5-го уровня (2к4), 11-го уровня (3к4) и 17-го уровня (4к4).",

    # === Level 1 Spells ===

    # === Alarm ===
    643: "Вы устанавливаете сигнализацию против нежелательного вторжения. Выберите дверь, окно или область в пределах дистанции, не превышающую 20-футовый куб. Пока заклинание не закончится, сигнализация предупреждает вас, когда Крошечное или более крупное существо касается защищённой области или входит в неё. При сотворении заклинания вы можете указать существ, которые не будут активировать сигнализацию. Вы также выбираете, будет ли сигнализация мысленной или звуковой.",
    645: "Мысленная сигнализация оповещает вас мысленным звоном, если вы находитесь в пределах 1 мили от защищённой области. Этот звон пробуждает вас, если вы спите.",
    647: "Звуковая сигнализация издаёт звук ручного колокольчика в течение 10 секунд в радиусе 60 футов.",

    # === Animal Friendship ===
    661: "Это заклинание позволяет убедить зверя, что вы не причините ему вреда. Выберите зверя, которого видите в пределах дистанции. Он должен видеть и слышать вас. Если Интеллект зверя 4 или выше, заклинание проваливается. В противном случае зверь должен преуспеть в спасброске Мудрости, иначе он будет очарован вами на время действия заклинания. Если вы или один из ваших спутников причинит вред цели, заклинание оканчивается.",
    663: "**_Использование ячейки более высокого уровня._** Если вы сотворяете это заклинание, используя ячейку заклинания 2-го уровня или выше, вы можете подействовать на одного дополнительного зверя за каждый уровень ячейки выше 1-го.",

    # === Bane ===
    677: "До трёх существ по вашему выбору, которых вы видите в пределах дистанции, должны совершить спасбросок Харизмы. Каждый раз, когда цель, провалившая этот спасбросок, совершает бросок атаки или спасбросок до окончания заклинания, она должна бросить к4 и вычесть результат из броска атаки или спасброска.",
    679: "**_Использование ячейки более высокого уровня._** Если вы сотворяете это заклинание, используя ячейку заклинания 2-го уровня или выше, вы можете нацелиться на одно дополнительное существо за каждый уровень ячейки выше 1-го.",

    # === Bless ===
    693: "Вы благословляете до трёх существ по вашему выбору в пределах дистанции. Каждый раз, когда цель совершает бросок атаки или спасбросок до окончания заклинания, она может бросить к4 и добавить результат к броску атаки или спасброску.",
    695: "**_Использование ячейки более высокого уровня._** Если вы сотворяете это заклинание, используя ячейку заклинания 2-го уровня или выше, вы можете нацелиться на одно дополнительное существо за каждый уровень ячейки выше 1-го.",

    # === Burning Hands ===
    709: "Сведя руки так, чтобы большие пальцы соприкасались, а пальцы были растопырены, вы выпускаете тонкую пелену пламени из кончиков пальцев. Каждое существо в 15-футовом конусе должно совершить спасбросок Ловкости. При провале существо получает 3к6 урона огнём, а при успехе — половину этого урона.",
    711: "Огонь поджигает все горючие предметы в области, которые никто не несёт и не носит.",
    713: "**_Использование ячейки более высокого уровня._** Если вы сотворяете это заклинание, используя ячейку заклинания 2-го уровня или выше, урон увеличивается на 1к6 за каждый уровень ячейки выше 1-го.",

    # === Charm Person ===
    727: "Вы пытаетесь очаровать гуманоида, которого видите в пределах дистанции. Он должен совершить спасбросок Мудрости, причём с преимуществом, если вы или ваши спутники сражаетесь с ним. При провале спасброска он очарован вами, пока заклинание не закончится или пока вы или ваши спутники не причинят ему вред. Очарованное существо считает вас дружественным знакомым. Когда заклинание оканчивается, существо знает, что было очаровано вами.",
    729: "**_Использование ячейки более высокого уровня._** Если вы сотворяете это заклинание, используя ячейку заклинания 2-го уровня или выше, вы можете нацелиться на одно дополнительное существо за каждый уровень ячейки выше 1-го. Существа должны находиться в пределах 30 футов друг от друга, когда вы нацеливаетесь на них.",

    # === Color Spray ===
    743: "Ослепительный поток мерцающего разноцветного света вырывается из вашей руки. Бросьте 6к10; результат показывает, сколько хитов существ может затронуть это заклинание. Существа в 15-футовом конусе, исходящем от вас, затрагиваются в порядке возрастания их текущих хитов (игнорируя существ без сознания и тех, кто не может видеть).",
    745: "Начиная с существа с наименьшим количеством текущих хитов, каждое существо, затронутое этим заклинанием, становится ослеплённым до конца вашего следующего хода. Вычтите хиты каждого существа из общей суммы, прежде чем перейти к существу со следующим наименьшим количеством хитов. Текущие хиты существа должны быть равны или меньше оставшейся суммы, чтобы существо было затронуто.",
    747: "**_Использование ячейки более высокого уровня._** Если вы сотворяете это заклинание, используя ячейку заклинания 2-го уровня или выше, бросьте дополнительно 2к10 за каждый уровень ячейки выше 1-го.",

    # === Command ===
    761: "Вы произносите однословную команду существу, которое видите в пределах дистанции. Цель должна преуспеть в спасброске Мудрости, иначе последует команде в свой следующий ход. Заклинание не действует, если цель — нежить, если она не понимает ваш язык или если ваша команда причинит ей прямой вред.",
    763: "Ниже приведены типичные команды и их эффекты. Вы можете отдать команду, не описанную здесь. В этом случае Мастер определяет поведение цели. Если цель не может выполнить вашу команду, заклинание оканчивается.",
    765: "**_Подойди._** Цель движется к вам кратчайшим и наиболее прямым путём и заканчивает свой ход, если оказывается в пределах 5 футов от вас.",
    767: "**_Брось._** Цель роняет то, что держит, и затем заканчивает свой ход.",
    769: "**_Беги._** Цель тратит свой ход на то, чтобы удалиться от вас максимально быстрым доступным способом.",
    771: "**_Падай._** Цель падает ничком и затем заканчивает свой ход.",
    773: "**_Стой._** Цель не перемещается и не совершает действий.",
    775: "Летающее существо остаётся в воздухе, если способно это делать. Если оно должно двигаться, чтобы оставаться в воздухе, оно пролетает минимальное расстояние, необходимое для этого.",
    777: "**_Использование ячейки более высокого уровня._** Если вы сотворяете это заклинание, используя ячейку заклинания 2-го уровня или выше, вы можете подействовать на одно дополнительное существо за каждый уровень ячейки выше 1-го. Существа должны находиться в пределах 30 футов друг от друга, когда вы нацеливаетесь на них.",

    # === Comprehend Languages ===
    791: "На время действия заклинания вы понимаете буквальное значение любого слышимого устного языка. Вы также понимаете любой письменный язык, но для этого должны касаться поверхности, на которой написаны слова. Чтение одной страницы текста занимает около 1 минуты.",
    793: "Это заклинание не расшифровывает тайные послания в тексте или глифы, такие как арканные символы, которые не являются частью письменного языка.",

    # === Create or Destroy Water ===
    807: "Вы создаёте или уничтожаете воду.",
    809: "**_Сотворение воды._** Вы создаёте до 10 галлонов чистой воды в пределах дистанции в открытом сосуде. Либо вода падает в виде дождя в 30-футовом кубе в пределах дистанции, потушив незащищённый огонь в этой области.",
    811: "**_Уничтожение воды._** Вы уничтожаете до 10 галлонов воды в открытом сосуде в пределах дистанции. Либо вы рассеиваете туман в 30-футовом кубе в пределах дистанции.",
    813: "**_Использование ячейки более высокого уровня._** Если вы сотворяете это заклинание, используя ячейку заклинания 2-го уровня или выше, вы создаёте или уничтожаете 10 дополнительных галлонов воды, или размер куба увеличивается на 5 футов, за каждый уровень ячейки выше 1-го.",

    # === Cure Wounds ===
    827: "Существо, которого вы касаетесь, восстанавливает количество хитов, равное 1к8 + ваш модификатор базовой характеристики заклинателя. Это заклинание не действует на нежить и конструктов.",
    829: "**_Использование ячейки более высокого уровня._** Если вы сотворяете это заклинание, используя ячейку заклинания 2-го уровня или выше, исцеление увеличивается на 1к8 за каждый уровень ячейки выше 1-го.",

    # === Detect Evil and Good ===
    843: "На время действия заклинания вы знаете, находится ли в пределах 30 футов от вас аберрация, небожитель, элементаль, фея, исчадие или нежить, а также где именно расположено это существо. Аналогично, вы знаете, есть ли в пределах 30 футов от вас место или предмет, которые были магически освящены или осквернены.",
    845: "Заклинание проникает сквозь большинство преград, но блокируется 1 футом камня, 1 дюймом обычного металла, тонким листом свинца или 3 футами дерева или земли.",

    # === Detect Magic ===
    859: "На время действия заклинания вы чувствуете присутствие магии в пределах 30 футов от вас. Если вы чувствуете магию таким образом, вы можете действием увидеть слабую ауру вокруг любого видимого существа или предмета в области, несущего магию, и узнать его школу магии, если таковая есть.",
    861: "Заклинание проникает сквозь большинство преград, но блокируется 1 футом камня, 1 дюймом обычного металла, тонким листом свинца или 3 футами дерева или земли.",

    # === Detect Poison and Disease ===
    875: "На время действия заклинания вы можете ощущать присутствие и расположение ядов, ядовитых существ и болезней в пределах 30 футов от вас. Вы также определяете вид яда, ядовитого существа или болезни в каждом случае.",
    877: "Заклинание проникает сквозь большинство преград, но блокируется 1 футом камня, 1 дюймом обычного металла, тонким листом свинца или 3 футами дерева или земли.",

    # === Disguise Self ===
    891: "Вы изменяете свой облик — включая одежду, доспехи, оружие и другие предметы при вас — пока заклинание не закончится или пока вы не отпустите его действием. Вы можете выглядеть на 1 фут ниже или выше и казаться худым, полным или средним. Вы не можете изменить тип своего тела, поэтому должны принять форму с таким же расположением конечностей. В остальном масштаб иллюзии зависит от вас.",
    893: "Изменения, создаваемые этим заклинанием, не выдерживают физической проверки. Например, если вы используете это заклинание, чтобы добавить шляпу к своему наряду, предметы будут проходить сквозь шляпу, и любой, кто коснётся её, ничего не почувствует или почувствует вашу голову и волосы. Если вы используете это заклинание, чтобы выглядеть худее, рука того, кто протянет руку, чтобы вас коснуться, наткнётся на вас, хотя на вид она ещё будет в воздухе.",
    895: "Чтобы распознать, что вы замаскированы, существо может действием осмотреть вашу внешность и должно преуспеть в проверке Интеллекта (Расследование) против СЛ спасброска от ваших заклинаний.",

    # === Divine Favor ===
    909: "Ваша молитва наделяет вас божественным сиянием. Пока заклинание не закончится, ваши атаки оружием наносят дополнительно 1к4 урона излучением при попадании.",

    # === Entangle ===
    923: "Цепкие сорняки и лианы прорастают из земли в 20-футовом квадрате, начиная с точки в пределах дистанции. На время действия заклинания эти растения делают землю в области труднопроходимой местностью.",
    925: "Существо, находящееся в области при сотворении заклинания, должно преуспеть в спасброске Силы, иначе оно будет опутано растениями, пока заклинание не закончится. Опутанное растениями существо может действием совершить проверку Силы против СЛ спасброска от ваших заклинаний. При успехе оно высвобождается.",
    927: "Когда заклинание оканчивается, сотворённые растения увядают.",

    # === Expeditious Retreat ===
    941: "Это заклинание позволяет вам двигаться с невероятной скоростью. Когда вы сотворяете это заклинание и затем бонусным действием в каждый свой ход, пока заклинание не закончится, вы можете совершить действие Рывок.",

    # === Faerie Fire ===
    955: "Каждый предмет в 20-футовом кубе в пределах дистанции обрисовывается синим, зелёным или фиолетовым светом (по вашему выбору). Любое существо в этой области при сотворении заклинания также обрисовывается светом, если провалит спасбросок Ловкости. На время действия заклинания предметы и затронутые существа излучают тусклый свет в радиусе 10 футов.",
    957: "Любой бросок атаки против затронутого существа или предмета совершается с преимуществом, если атакующий может его видеть, и затронутое существо или предмет не может получать выгоду от невидимости.",

    # === False Life ===
    971: "Укрепляя себя некромантическим подобием жизни, вы получаете 1к4 + 4 временных хитов на время действия заклинания.",
    973: "**_Использование ячейки более высокого уровня._** Если вы сотворяете это заклинание, используя ячейку заклинания 2-го уровня или выше, вы получаете 5 дополнительных временных хитов за каждый уровень ячейки выше 1-го.",

    # === Feather Fall ===
    987: "Выберите до пяти падающих существ в пределах дистанции. Скорость падения каждого падающего существа замедляется до 60 футов за раунд, пока заклинание не закончится. Если существо приземлится до окончания заклинания, оно не получает урона от падения и может приземлиться на ноги, и заклинание для этого существа оканчивается.",

    # === Find Familiar ===
    1001: "Вы получаете услужение фамильяра — духа, принимающего облик выбранного вами животного: летучей мыши, кошки, краба, лягушки (жабы), ястреба, ящерицы, осьминога, совы, ядовитой змеи, рыбы (пираньи), крысы, ворона, морского конька, паука или ласки. Появляясь в свободном пространстве в пределах дистанции, фамильяр обладает характеристиками выбранной формы, хотя является небожителем, феей или исчадием (по вашему выбору), а не зверем.",
    1003: "Ваш фамильяр действует независимо от вас, но всегда выполняет ваши команды. В бою он бросает свою собственную инициативу и действует в свой ход. Фамильяр не может атаковать, но может совершать другие действия как обычно.",
    1005: "Когда хиты фамильяра опускаются до 0, он исчезает, не оставляя физической формы. Он появляется снова после повторного сотворения этого заклинания.",
    1007: "Пока ваш фамильяр находится в пределах 100 футов от вас, вы можете общаться с ним телепатически. Кроме того, действием вы можете смотреть его глазами и слышать то, что он слышит, до начала вашего следующего хода, получая преимущества любых особых чувств фамильяра. В это время вы глухи и слепы в отношении своих собственных чувств.",
    1009: "Действием вы можете временно отпустить фамильяра. Он исчезает в карманном измерении, где ожидает вашего призыва. Либо вы можете отпустить его навсегда. Действием, пока он временно отпущен, вы можете заставить его появиться в любом свободном пространстве в пределах 30 футов от вас.",
    1011: "У вас не может быть более одного фамильяра одновременно. Если вы сотворите это заклинание, уже имея фамильяра, вы заставите его принять новую форму. Выберите одну из форм из вышеуказанного списка. Ваш фамильяр превращается в выбранное существо.",
    1013: "Наконец, когда вы сотворяете заклинание с дистанцией «касание», ваш фамильяр может передать заклинание, как если бы он его сотворил. Ваш фамильяр должен находиться в пределах 100 футов от вас и должен использовать свою реакцию для передачи заклинания, когда вы его сотворяете. Если заклинание требует броска атаки, вы используете свой модификатор атаки для броска.",
}

# ============================================================
# Spell name mapping (same as before)
# ============================================================
SN = {
    "Acid Splash":"Кислотные брызги","Chill Touch":"Могильный холод","Dancing Lights":"Танцующие огоньки",
    "Druidcraft":"Искусство друидов","Eldritch Blast":"Мистический заряд","Fire Bolt":"Огненный снаряд",
    "Guidance":"Указание","Light":"Свет","Mage Hand":"Волшебная рука","Mending":"Починка",
    "Message":"Сообщение","Minor Illusion":"Малая иллюзия","Poison Spray":"Ядовитые брызги",
    "Prestidigitation":"Фокусы","Produce Flame":"Сотворение пламени","Ray of Frost":"Луч холода",
    "Resistance":"Сопротивление","Sacred Flame":"Священное пламя","Shillelagh":"Дубинка",
    "Shocking Grasp":"Шоковый захват","Spare the Dying":"Сопровождение умирающего",
    "Thaumaturgy":"Тауматургия","True Strike":"Верный удар","Vicious Mockery":"Язвительная насмешка",
    "Alarm":"Тревога","Animal Friendship":"Дружба с животными","Bane":"Порча","Bless":"Благословение",
    "Burning Hands":"Огненные руки","Charm Person":"Очарование личности","Color Spray":"Цветные брызги",
    "Command":"Приказ","Comprehend Languages":"Понимание языков",
    "Create or Destroy Water":"Сотворение или уничтожение воды","Cure Wounds":"Лечение ран",
    "Detect Evil and Good":"Обнаружение добра и зла","Detect Magic":"Обнаружение магии",
    "Detect Poison and Disease":"Обнаружение яда и болезни","Disguise Self":"Маскировка",
    "Divine Favor":"Божественное благоволение","Entangle":"Опутывание",
    "Expeditious Retreat":"Поспешное отступление","Faerie Fire":"Огонь фей","False Life":"Псевдожизнь",
    "Feather Fall":"Падение пёрышком","Find Familiar":"Поиск фамильяра","Floating Disk":"Парящий диск",
    "Fog Cloud":"Туманное облако","Goodberry":"Чудо-ягоды","Grease":"Скольжение",
    "Guiding Bolt":"Направляющий снаряд","Healing Word":"Целебное слово",
    "Hellish Rebuke":"Адское возмездие","Heroism":"Героизм","Hideous Laughter":"Жуткий смех",
    "Hunter's Mark":"Метка охотника","Identify":"Опознание","Illusory Script":"Иллюзорный текст",
    "Inflict Wounds":"Нанесение ран","Jump":"Прыжок","Longstrider":"Скороход",
    "Mage Armor":"Доспехи мага","Magic Missile":"Магическая стрела",
    "Protection from Evil and Good":"Защита от добра и зла","Purify Food and Drink":"Очистить пищу и питьё",
    "Sanctuary":"Святилище","Shield":"Щит","Shield of Faith":"Щит веры","Silent Image":"Немой образ",
    "Sleep":"Усыпление","Speak with Animals":"Разговор с животными","Thunderwave":"Волна грома",
    "Unseen Servant":"Невидимый слуга","Acid Arrow":"Кислотная стрела","Aid":"Помощь",
    "Alter Self":"Смена обличья","Animal Messenger":"Животный посланник","Arcane Lock":"Арканный замок",
    "Arcanist's Magic Aura":"Аура арканиста","Augury":"Предсказание","Barkskin":"Кора",
    "Blindness/Deafness":"Слепота/Глухота","Blur":"Размытость","Branding Smite":"Клеймящая кара",
    "Calm Emotions":"Успокоение эмоций","Continual Flame":"Вечный огонь","Darkness":"Тьма",
    "Darkvision":"Тёмное зрение","Detect Thoughts":"Обнаружение мыслей",
    "Enhance Ability":"Улучшение характеристики","Enlarge/Reduce":"Увеличение/уменьшение",
    "Enthrall":"Завораживание","Find Steed":"Поиск скакуна","Find Traps":"Поиск ловушек",
    "Flame Blade":"Пылающий клинок","Flaming Sphere":"Пылающая сфера",
    "Gentle Repose":"Бальзамирование","Gust of Wind":"Порыв ветра","Heat Metal":"Раскалённый металл",
    "Hold Person":"Удержание личности","Invisibility":"Невидимость","Knock":"Открывание",
    "Lesser Restoration":"Малое восстановление","Levitate":"Левитация",
    "Locate Animals or Plants":"Поиск животных или растений","Locate Object":"Поиск объекта",
    "Magic Mouth":"Волшебные уста","Magic Weapon":"Волшебное оружие","Mirror Image":"Отражения",
    "Misty Step":"Туманный шаг","Moonbeam":"Лунный луч","Pass without Trace":"Бесследное передвижение",
    "Prayer of Healing":"Молитва исцеления","Protection from Poison":"Защита от яда",
    "Ray of Enfeeblement":"Луч ослабления","Rope Trick":"Верёвочный фокус",
    "Scorching Ray":"Палящий луч","See Invisibility":"Видение невидимого","Shatter":"Дребезги",
    "Silence":"Тишина","Spider Climb":"Паучье лазание","Spike Growth":"Шипы",
    "Spiritual Weapon":"Духовное оружие","Suggestion":"Внушение","Warding Bond":"Защитные узы",
    "Web":"Паутина","Zone of Truth":"Зона правды","Animate Dead":"Оживление мёртвых",
    "Beacon of Hope":"Маяк надежды","Bestow Curse":"Наложение проклятия","Blink":"Мерцание",
    "Call Lightning":"Молния с небес","Clairvoyance":"Ясновидение",
    "Conjure Animals":"Призыв животных","Counterspell":"Контрзаклинание",
    "Create Food and Water":"Сотворение пищи и воды","Daylight":"Дневной свет",
    "Dispel Magic":"Рассеивание магии","Fear":"Страх","Fireball":"Огненный шар","Fly":"Полёт",
    "Gaseous Form":"Газообразная форма","Glyph of Warding":"Охранные руны","Haste":"Ускорение",
    "Hypnotic Pattern":"Гипнотический узор","Lightning Bolt":"Молния",
    "Magic Circle":"Магический круг","Major Image":"Высший образ",
    "Mass Healing Word":"Массовое целебное слово","Meld into Stone":"Слияние с камнем",
    "Nondetection":"Необнаружимость","Phantom Steed":"Призрачный скакун",
    "Plant Growth":"Рост растений","Protection from Energy":"Защита от энергии",
    "Remove Curse":"Снятие проклятия","Revivify":"Возвращение к жизни","Sending":"Послание",
    "Sleet Storm":"Слякотный дождь","Slow":"Замедление","Speak with Dead":"Разговор с мёртвыми",
    "Speak with Plants":"Разговор с растениями","Spirit Guardians":"Духовные стражи",
    "Stinking Cloud":"Удушающее облако","Tiny Hut":"Крошечная хижина","Tongues":"Языки",
    "Vampiric Touch":"Прикосновение вампира","Water Breathing":"Дыхание под водой",
    "Water Walk":"Хождение по воде","Wind Wall":"Стена ветра","Arcane Eye":"Арканный глаз",
    "Banishment":"Изгнание","Black Tentacles":"Чёрные щупальца","Blight":"Гниль",
    "Compulsion":"Принуждение","Confusion":"Замешательство",
    "Conjure Minor Elementals":"Призыв малых элементалей",
    "Conjure Woodland Beings":"Призыв лесных существ","Control Water":"Власть над водой",
    "Death Ward":"Защита от смерти","Dimension Door":"Дверь измерений","Divination":"Гадание",
    "Dominate Beast":"Подчинение зверя","Fabricate":"Фабрикация","Faithful Hound":"Верный пёс",
    "Fire Shield":"Огненный щит","Freedom of Movement":"Свобода перемещения",
    "Giant Insect":"Гигантское насекомое","Greater Invisibility":"Высшая невидимость",
    "Guardian of Faith":"Страж веры","Hallucinatory Terrain":"Иллюзорная местность",
    "Ice Storm":"Град","Locate Creature":"Поиск существа","Phantasmal Killer":"Призрачный убийца",
    "Polymorph":"Превращение","Private Sanctum":"Личное убежище",
    "Resilient Sphere":"Упругая сфера","Secret Chest":"Тайный сундук",
    "Stone Shape":"Изменение формы камня","Stoneskin":"Каменная кожа","Wall of Fire":"Стена огня",
    "Animate Objects":"Оживление предметов","Antilife Shell":"Барьер жизни",
    "Arcane Hand":"Арканная рука","Awaken":"Пробуждение","Cloudkill":"Облако убийства",
    "Commune":"Причастие","Commune with Nature":"Связь с природой","Cone of Cold":"Конус холода",
    "Conjure Elemental":"Сотворение элементаля","Contact Other Plane":"Связь с иным планом",
    "Contagion":"Заражение","Creation":"Сотворение","Dispel Evil and Good":"Рассеивание добра и зла",
    "Dominate Person":"Подчинение личности","Dream":"Сон","Flame Strike":"Небесный огонь",
    "Geas":"Обет","Greater Restoration":"Высшее восстановление","Hallow":"Освящение",
    "Hold Monster":"Удержание чудовища","Insect Plague":"Нашествие насекомых",
    "Legend Lore":"Знание легенд","Mass Cure Wounds":"Массовое исцеление ран",
    "Mislead":"Введение в заблуждение","Modify Memory":"Изменение памяти","Passwall":"Проход",
    "Planar Binding":"Планарные узы","Raise Dead":"Воскрешение мёртвых",
    "Reincarnate":"Реинкарнация","Scrying":"Наблюдение","Seeming":"Ложный облик",
    "Telekinesis":"Телекинез","Telepathic Bond":"Телепатическая связь",
    "Teleportation Circle":"Круг телепортации","Tree Stride":"Шаг сквозь деревья",
    "Wall of Force":"Стена силы","Wall of Stone":"Каменная стена",
    "Blade Barrier":"Стена клинков","Chain Lightning":"Цепная молния",
    "Circle of Death":"Круг смерти","Conjure Fey":"Сотворение феи",
    "Contingency":"Предусмотрительность","Create Undead":"Создание нежити",
    "Disintegrate":"Распыление","Eyebite":"Зловещий взгляд","Find the Path":"Поиск пути",
    "Flesh to Stone":"Окаменение","Forbiddance":"Запрет","Freezing Sphere":"Морозная сфера",
    "Globe of Invulnerability":"Сфера неуязвимости","Guards and Wards":"Стражи и обереги",
    "Harm":"Нанесение вреда","Heal":"Исцеление","Heroes' Feast":"Пир героев",
    "Instant Summons":"Мгновенный призыв","Irresistible Dance":"Непреодолимый танец",
    "Magic Jar":"Волшебный сосуд","Mass Suggestion":"Массовое внушение",
    "Move Earth":"Движение земли","Planar Ally":"Планарный союзник",
    "Programmed Illusion":"Запрограммированная иллюзия","Sunbeam":"Солнечный луч",
    "Transport via Plants":"Перемещение растениями","True Seeing":"Видение истины",
    "Wall of Ice":"Стена льда","Wall of Thorns":"Стена тернов","Wind Walk":"Хождение по ветру",
    "Word of Recall":"Слово возврата","Arcane Sword":"Арканный меч",
    "Conjure Celestial":"Призыв небожителя","Delayed Blast Fireball":"Замедленный огненный шар",
    "Divine Word":"Божественное слово","Etherealness":"Эфирность","Finger of Death":"Перст смерти",
    "Fire Storm":"Огненная буря","Forcecage":"Силовая клетка",
    "Magnificent Mansion":"Великолепный особняк","Mirage Arcane":"Мираж",
    "Plane Shift":"Переход между планами","Prismatic Spray":"Радужные брызги",
    "Project Image":"Проецирование образа","Regenerate":"Регенерация",
    "Resurrection":"Воскрешение","Reverse Gravity":"Разворот гравитации","Sequester":"Изоляция",
    "Simulacrum":"Симулякр","Symbol":"Символ","Teleport":"Телепорт",
    "Animal Shapes":"Животные формы","Antimagic Field":"Антимагическое поле",
    "Antipathy/Sympathy":"Антипатия/Симпатия","Clone":"Клон",
    "Control Weather":"Власть над погодой","Demiplane":"Полуплан",
    "Dominate Monster":"Подчинение чудовища","Earthquake":"Землетрясение",
    "Feeblemind":"Помрачение","Glibness":"Дар красноречия","Holy Aura":"Аура святости",
    "Incendiary Cloud":"Огненное облако","Maze":"Лабиринт","Mind Blank":"Пустой разум",
    "Power Word Stun":"Слово силы: оглушение","Sunburst":"Солнечный удар",
    "Astral Projection":"Астральная проекция","Foresight":"Предвидение","Gate":"Врата",
    "Imprisonment":"Заточение","Mass Heal":"Массовое исцеление","Meteor Swarm":"Метеоритный дождь",
    "Power Word Kill":"Слово силы: смерть","Prismatic Wall":"Радужная стена",
    "Shapechange":"Изменение формы","Storm of Vengeance":"Буря возмездия",
    "Time Stop":"Остановка времени","True Polymorph":"Истинный полиморф",
    "True Resurrection":"Истинное воскрешение","Weird":"Кошмар","Wish":"Исполнение желаний",
}

CN = {"Bard":"Бард","Cleric":"Жрец","Druid":"Друид","Paladin":"Паладин","Ranger":"Следопыт",
      "Sorcerer":"Чародей","Warlock":"Колдун","Wizard":"Волшебник"}

SCH = {"Abjuration":"Ограждение","Conjuration":"Вызов","Divination":"Прорицание",
       "Enchantment":"Очарование","Evocation":"Воплощение","Illusion":"Иллюзия",
       "Necromancy":"Некромантия","Transmutation":"Преобразование"}

SCH_GEN = {"Ограждение":"Ограждения","Вызов":"Вызова","Прорицание":"Прорицания",
           "Очарование":"Очарования","Воплощение":"Воплощения","Иллюзия":"Иллюзии",
           "Некромантия":"Некромантии","Преобразование":"Преобразования"}

MATS = {
    "(a tiny bell and a piece of fine silver wire)":"(крошечный колокольчик и кусочек тонкой серебряной проволоки)",
    "(a bit of phosphorus or wychwood, or a glowworm)":"(кусочек фосфора или гнилушки, или светлячок)",
    "(a firefly or phosphorescent moss)":"(светлячок или фосфоресцирующий мох)",
    "(two lodestones)":"(два магнитных камня)",
    "(a short piece of copper wire)":"(короткий кусок медной проволоки)",
    "(a bit of fleece)":"(кусочек овечьей шерсти)",
    "(mistletoe, a shamrock leaf, and a club or quarterstaff)":"(омела, лист клевера и дубинка или боевой посох)",
    "(a miniature cloak)":"(миниатюрный плащ)",
    "(a drop of blood)":"(капля крови)",
    "(a sprinkling of holy water)":"(капля святой воды)",
    "(a tiny strip of white cloth)":"(крошечная полоска белой ткани)",
    "(a pinch of fine sand, rose petals, or crickets)":"(щепотка мелкого песка, лепестки роз или сверчки)",
    "(a tiny ball of bat guano and sulfur)":"(крошечный шарик из помёта летучей мыши и серы)",
    "(a piece of string and a bit of wood)":"(кусок верёвки и щепка дерева)",
    "(a pinch of sand)":"(щепотка песка)",
    "(a snake's tongue and either a bit of honeycomb or a drop of sweet oil)":"(змеиный язык и либо кусочек медовых сот, либо капля сладкого масла)",
    "(a small square piece of silk)":"(маленький квадратный кусок шёлка)",
    "(a bit of spider web)":"(кусочек паутины)",
    "(diamonds worth 300 gp, which the spell consumes)":"(бриллианты стоимостью 300 зм, расходуемые заклинанием)",
    "(a bit of phosphorus)":"(кусочек фосфора)",
    "(a morsel of food)":"(кусочек еды)",
    "(a drop of water if creating water or a few grains of sand if destroying it)":"(капля воды при создании воды или несколько крупинок песка при уничтожении)",
    "(a pinch of powder or sand that is colored red, yellow, and blue)":"(щепотка красного, жёлтого и синего порошка или песка)",
    "(a pinch of soot and salt)":"(щепотка сажи и соли)",
    "(a yew leaf)":"(лист тиса)",
    "(a small amount of alcohol or distilled spirits)":"(небольшое количество алкоголя или крепкого напитка)",
    "(a small feather or piece of down)":"(маленькое перо или кусочек пуха)",
    "(a drop of mercury)":"(капля ртути)",
    "(a bit of fur and a piece of amber, crystal, or glass rod)":"(кусочек меха и янтарь, кристалл или стеклянная палочка)",
    "(an eyelash encased in gum arabic)":"(ресница, замурованная в гуммиарабике)",
    "(a bit of fur and a small iron rod)":"(кусочек меха и маленький железный стержень)",
    "(a pinch of talc and a small sprinkling of powdered silver)":"(щепотка талька и немного серебряного порошка)",
    "(a small bit of honey for the suggestion)":"(кусочек мёда при внушении)",
    "(a lead-based ink worth at least 10 gp, which the spell consumes)":"(чернила на основе свинца стоимостью не менее 10 зм, расходуемые заклинанием)",
    "(a piece of iron and a flame)":"(кусок железа и пламя)",
    "(a bit of fur; a piece of amber, glass, or a crystal rod; and three silver pins)":"(кусочек меха; кусочек янтаря, стекла или хрустальная палочка; и три серебряные булавки)",
    "(a chip of mica)":"(осколок слюды)",
    "(a piece of cured leather)":"(кусок дублёной кожи)",
    "(a sunburst pendant worth at least 100 gp)":"(подвеска в виде солнца стоимостью не менее 100 зм)",
    "(a jewel worth at least 1,000 gp, which the spell consumes)":"(драгоценный камень стоимостью не менее 1 000 зм, расходуемый заклинанием)",
    "(incense and a vial of holy or unholy water)":"(благовоние и сосуд со святой или осквернённой водой)",
    "(powdered diamond worth at least 100 gp, which the spell consumes)":"(алмазный порошок стоимостью не менее 100 зм, расходуемый заклинанием)",
    "(mercury, phosphorus, and powdered diamond and opal with a total value of at least 1,000 gp, which the spell consumes)":"(ртуть, фосфор и алмазный и опаловый порошок общей стоимостью не менее 1 000 зм, расходуемые заклинанием)",
    "(a tiny piece of matter of the same type of the item you plan to create)":"(крошечный кусочек материала того же типа, что и предмет, который вы планируете создать)",
    "(a tiny reliquary worth at least 1,000 gp containing a sacred relic, such as a scrap of cloth from a saint's robe or a piece of parchment from a religious text)":"(крошечный ковчег стоимостью не менее 1 000 зм, содержащий священную реликвию, например лоскут ткани от рясы святого или кусок пергамента из религиозного текста)",
    "(diamond dust worth 100 gp, which the spell consumes)":"(алмазная пыль стоимостью 100 зм, расходуемая заклинанием)",
    "(a diamond worth at least 300 gp, which the spell consumes)":"(бриллиант стоимостью не менее 300 зм, расходуемый заклинанием)",
    "(a diamond worth at least 500 gp, which the spell consumes)":"(бриллиант стоимостью не менее 500 зм, расходуемый заклинанием)",
    "(a diamond worth at least 1,000 gp, which the spell consumes)":"(бриллиант стоимостью не менее 1 000 зм, расходуемый заклинанием)",
    "(a focus worth at least 1,000 gp, such as a crystal ball, a silver mirror, or a font filled with holy water)":"(фокусировка стоимостью не менее 1 000 зм, например хрустальный шар, серебряное зеркало или купель со святой водой)",
    "(a small clay model of a ziggurat)":"(маленькая глиняная модель зиккурата)",
    "(a jeweled horn worth at least 100 gp)":"(усыпанный драгоценностями рог стоимостью не менее 100 зм)",
    "(ivory strips worth at least 200 gp)":"(полоски слоновой кости стоимостью не менее 200 зм)",
    "(a gem-encrusted bowl worth at least 1,000 gp)":"(инкрустированная драгоценностями чаша стоимостью не менее 1 000 зм)",
    "(incense worth at least 25 gp, which the spell consumes)":"(благовоние стоимостью не менее 25 зм, расходуемое заклинанием)",
    "(fur or a feather from a beast)":"(мех или перо зверя)",
    # --- Additional material components ---
    "(10 gp worth of charcoal, incense, and herbs that must be consumed by fire in a brass brazier)":"(древесный уголь, благовоние и травы стоимостью 10 зм, которые должны быть сожжены в медной жаровне)",
    "(a sprig of mistletoe)":"(веточка омелы)",
    "(a bit of pork rind or butter)":"(кусочек свиной шкурки или масло)",
    "(tiny tarts and a feather that is waved in the air)":"(крошечные пирожки и перо, которым машут в воздухе)",
    "(a pearl worth at least 100 gp and an owl feather)":"(жемчужина стоимостью не менее 100 зм и совиное перо)",
    "(a grasshopper's hind leg)":"(задняя нога кузнечика)",
    "(a pinch of dirt)":"(щепотка грязи)",
    "(holy water or powdered silver and iron, which the spell consumes)":"(святая вода или порошковое серебро и железо, расходуемые заклинанием)",
    "(a small silver mirror)":"(маленькое серебряное зеркало)",
    "(a small parchment with a bit of holy text written on it)":"(маленький пергамент с написанным на нём священным текстом)",
    "(a pinch of fine sand, rose petals, or a cricket)":"(щепотка мелкого песка, лепестки роз или сверчок)",
    "(powdered rhubarb leaf and an adder's stomach)":"(порошок из листа ревеня и желудок гадюки)",
    "(gold dust worth at least 25 gp, which the spell consumes)":"(золотая пыль стоимостью не менее 25 зм, расходуемая заклинанием)",
    "(a small square of silk)":"(маленький квадратный кусок шёлка)",
    "(specially marked sticks, bones, or similar tokens worth at least 25 gp)":"(специально помеченные палочки, кости или аналогичные знаки стоимостью не менее 25 зм)",
    "(a handful of oak bark)":"(горсть дубовой коры)",
    "(ruby dust worth 50 gp, which the spell consumes)":"(рубиновая пыль стоимостью 50 зм, расходуемая заклинанием)",
    "(bat fur and a drop of pitch or piece of coal)":"(мех летучей мыши и капля дёгтя или кусочек угля)",
    "(either a pinch of dried carrot or an agate)":"(либо щепотка сушёной моркови, либо агат)",
    "(a copper piece)":"(медная монета)",
    "(a pinch of powdered iron)":"(щепотка железного порошка)",
    "(leaf of sumac)":"(лист сумаха)",
    "(a bit of tallow, a pinch of brimstone, and a dusting of powdered iron)":"(кусочек жира, щепотка серы и немного железного порошка)",
    "(a pinch of salt and one copper piece placed on each of the corpse's eyes, which must remain there for the duration)":"(щепотка соли и по одной медной монете на каждый глаз трупа, которые должны оставаться на месте на время действия заклинания)",
    "(a legume seed)":"(семя бобового растения)",
    "(a small, straight piece of iron)":"(маленький прямой кусок железа)",
    "(either a small leather loop or a piece of golden wire bent into a cup shape with a long shank on one end)":"(либо маленькая кожаная петля, либо кусок золотой проволоки, согнутый в форме чаши с длинным стержнем на одном конце)",
    "(a bit of fur from a bloodhound)":"(клочок шерсти ищейки)",
    "(a forked twig)":"(раздвоенная веточка)",
    "(a small bit of honeycomb and jade dust worth at least 10 gp, which the spell consumes)":"(кусочек медовых сот и нефритовая пыль стоимостью не менее 10 зм, расходуемая заклинанием)",
    "(several seeds of any moonseed plant and a piece of opalescent feldspar)":"(несколько семян луносемянника и кусочек опалесцирующего полевого шпата)",
    "(ashes from a burned leaf of mistletoe and a sprig of spruce)":"(пепел от сожжённого листа омелы и веточка ели)",
    "(powdered corn extract and a twisted loop of parchment)":"(кукурузный порошок и скрученная петля пергамента)",
    "(a drop of bitumen and a spider)":"(капля битума и паук)",
    "(seven sharp thorns or seven small twigs, each sharpened to a point)":"(семь острых шипов или семь маленьких веточек, каждая заострённая на конце)",
    "(a pair of platinum rings worth at least 50 gp each, which you and the target must wear for the duration)":"(пара платиновых колец стоимостью не менее 50 зм каждое, которые вы и цель должны носить на время действия заклинания)",
    "(a bit of spiderweb)":"(кусочек паутины)",
    "(a drop of blood, a piece of flesh, and a pinch of bone dust)":"(капля крови, кусочек плоти и щепотка костной пыли)",
    "(a focus worth at least 100 gp, either a jeweled horn for hearing or a glass eye for seeing)":"(фокусировка стоимостью не менее 100 зм, либо усыпанный драгоценностями рог для слуха, либо стеклянный глаз для зрения)",
    "(a white feather or the heart of a hen)":"(белое перо или сердце курицы)",
    "(a wing feather from any bird)":"(маховое перо любой птицы)",
    "(a bit of gauze and a wisp of smoke)":"(кусочек марли и завиток дыма)",
    "(incense and powdered diamond worth at least 200 gp, which the spell consumes)":"(благовоние и алмазный порошок стоимостью не менее 200 зм, расходуемые заклинанием)",
    "(a shaving of licorice root)":"(стружка корня солодки)",
    "(a glowing stick of incense or a crystal vial filled with phosphorescent material)":"(светящаяся палочка благовония или хрустальный сосуд, наполненный фосфоресцирующим веществом)",
    "(a bit of fur and a rod of amber, crystal, or glass)":"(кусочек меха и янтарная, хрустальная или стеклянная палочка)",
    "(holy water or powdered silver and iron worth at least 100 gp, which the spell consumes)":"(святая вода или порошковое серебро и железо стоимостью не менее 100 зм, расходуемые заклинанием)",
    "(a pinch of diamond dust worth 25 gp sprinkled over the target, which the spell consumes)":"(щепотка алмазной пыли стоимостью 25 зм, посыпанная на цель, расходуемая заклинанием)",
    "(a short piece of fine copper wire)":"(короткий кусок тонкой медной проволоки)",
    "(a pinch of dust and a few drops of water)":"(щепотка пыли и несколько капель воды)",
    "(a drop of molasses)":"(капля патоки)",
    "(burning incense)":"(горящее благовоние)",
    "(a holy symbol)":"(священный символ)",
    "(a rotten egg or several skunk cabbage leaves)":"(тухлое яйцо или несколько листьев симплокарпуса)",
    "(a small crystal bead)":"(маленькая хрустальная бусина)",
    "(a short reed or piece of straw)":"(короткий тростник или соломинка)",
    "(a piece of cork)":"(кусочек пробки)",
    "(a tiny fan and a feather of exotic origin)":"(крошечный веер и перо экзотического происхождения)",
    "(a bit of bat fur)":"(кусочек меха летучей мыши)",
    "(an item distasteful to the target)":"(предмет, неприятный цели)",
    "(a piece of tentacle from a giant octopus or a giant squid)":"(кусок щупальца гигантского осьминога или гигантского кальмара)",
    "(three nut shells)":"(три ореховые скорлупки)",
    "(one holly berry per creature summoned)":"(по одной ягоде падуба на каждое призванное существо)",
    "(a drop of water and a pinch of dust)":"(капля воды и щепотка пыли)",
    "(incense and a sacrificial offering appropriate to your religion, together worth at least 25 gp, which the spell consumes)":"(благовоние и жертвенное подношение, соответствующее вашей религии, общей стоимостью не менее 25 зм, расходуемые заклинанием)",
    "(a tiny silver whistle, a piece of bone, and a thread)":"(крошечный серебряный свисток, кусочек кости и нить)",
    "(a bit of phosphorus or a firefly)":"(кусочек фосфора или светлячок)",
    "(a leather strap, bound around the arm or a similar appendage)":"(кожаный ремешок, обвязанный вокруг руки или аналогичной конечности)",
    "(a stone, a twig, and a bit of green plant)":"(камень, веточка и кусочек зелёного растения)",
    "(a caterpillar cocoon)":"(кокон гусеницы)",
    "(a thin sheet of lead, a piece of opaque glass, a wad of cotton or cloth, and powdered chrysolite)":"(тонкий лист свинца, кусочек непрозрачного стекла, комочек ваты или ткани и порошок хризолита)",
    "(a hemispherical piece of clear crystal and a matching hemispherical piece of gum arabic)":"(полусферический кусочек прозрачного кристалла и соответствующий полусферический кусочек гуммиарабика)",
    "(an exquisite chest, 3 feet by 2 feet by 2 feet, constructed from rare materials worth at least 5,000 gp, and a Tiny replica made from the same materials worth at least 50 gp)":"(великолепный сундук размером 3 на 2 на 2 фута, изготовленный из редких материалов стоимостью не менее 5 000 зм, и Крошечная копия из тех же материалов стоимостью не менее 50 зм)",
    "(soft clay, which must be worked into roughly the desired shape of the stone object)":"(мягкая глина, которой нужно придать приблизительную форму желаемого каменного предмета)",
    "(a small piece of phosphorus)":"(маленький кусочек фосфора)",
    "(an eggshell and a snakeskin glove)":"(яичная скорлупа и перчатка из змеиной кожи)",
    "(an agate worth at least 1,000 gp, which the spell consumes)":"(агат стоимостью не менее 1 000 зм, расходуемый заклинанием)",
    "(a small crystal or glass cone)":"(маленький хрустальный или стеклянный конус)",
    "(burning incense for air, soft clay for earth, sulfur and phosphorus for fire, or water and sand for water)":"(горящее благовоние для воздуха, мягкая глина для земли, сера и фосфор для огня или вода и песок для воды)",
    "(holy water or powdered silver and iron)":"(святая вода или порошковое серебро и железо)",
    "(a handful of sand, a dab of ink, and a writing quill plucked from a sleeping bird)":"(горсть песка, капля чернил и писчее перо, выдернутое у спящей птицы)",
    "(pinch of sulfur)":"(щепотка серы)",
    "(diamond dust worth at least 100 gp, which the spell consumes)":"(алмазная пыль стоимостью не менее 100 зм, расходуемая заклинанием)",
    "(herbs, oils, and incense worth at least 1,000 gp, which the spell consumes)":"(травы, масла и благовоние стоимостью не менее 1 000 зм, расходуемые заклинанием)",
    "(a few grains of sugar, some kernels of grain, and a smear of fat)":"(несколько крупинок сахара, несколько зёрен и мазок жира)",
    "(incense worth at least 250 gp, which the spell consumes, and four ivory strips worth at least 50 gp each)":"(благовоние стоимостью не менее 250 зм, расходуемое заклинанием, и четыре полоски слоновой кости стоимостью не менее 50 зм каждая)",
    "(a pinch of sesame seeds)":"(щепотка кунжутных семян)",
    "(rare oils and unguents worth at least 1,000 gp, which the spell consumes)":"(редкие масла и мази стоимостью не менее 1 000 зм, расходуемые заклинанием)",
    "(pieces of eggshell from two different kinds of creatures)":"(кусочки яичной скорлупы двух разных видов существ)",
    "(rare chalks and inks infused with precious gems with 50 gp, which the spell consumes)":"(редкие мелки и чернила, настоянные на драгоценных камнях, стоимостью 50 зм, расходуемые заклинанием)",
    "(a pinch of powder made by crushing a clear gemstone)":"(щепотка порошка из растёртого прозрачного драгоценного камня)",
    "(a small block of granite)":"(маленький блок гранита)",
    "(the powder of a crushed black pearl worth at least 500 gp)":"(порошок из растёртой чёрной жемчужины стоимостью не менее 500 зм)",
    "(a statuette of yourself carved from ivory and decorated with gems worth at least 1,500 gp)":"(статуэтка вас из слоновой кости, украшенная драгоценностями, стоимостью не менее 1 500 зм)",
    "(one clay pot filled with grave dirt, one clay pot filled with brackish water, and one 150 gp black onyx stone for each corpse)":"(один глиняный горшок, наполненный могильной землёй, один глиняный горшок, наполненный солоноватой водой, и один чёрный ониксовый камень стоимостью 150 зм на каждый труп)",
    "(a lodestone and a pinch of dust)":"(магнитный камень и щепотка пыли)",
    "(a set of divinatory tools—such as bones, ivory sticks, cards, teeth, or carved runes-worth 100 gp and an object from the location you wish to find)":"(набор инструментов для гадания — такие как кости, палочки из слоновой кости, карты, зубы или резные руны — стоимостью 100 зм и предмет из места, которое вы хотите найти)",
    "(a pinch of lime, water, and earth)":"(щепотка извести, вода и земля)",
    "(a sprinkling of holy water, rare incense, and powdered ruby worth at least 1,000 gp)":"(капля святой воды, редкое благовоние и рубиновый порошок стоимостью не менее 1 000 зм)",
    "(a small crystal sphere)":"(маленькая хрустальная сфера)",
    "(a glass or crystal bead that shatters when the spell ends)":"(стеклянная или хрустальная бусина, которая разбивается, когда заклинание заканчивается)",
    "(burning incense, a small measure of brimstone and oil, a knotted string, a small amount of umber hulk blood, and a small silver rod worth at least 10 gp)":"(горящее благовоние, немного серы и масла, завязанная узлом верёвка, немного крови амбер-халка и маленький серебряный стержень стоимостью не менее 10 зм)",
    "(a gem-encrusted bowl worth at least 1,000 gp, which the spell consumes)":"(инкрустированная драгоценностями чаша стоимостью не менее 1 000 зм, расходуемая заклинанием)",
    "(a sapphire worth 1,000 gp)":"(сапфир стоимостью 1 000 зм)",
    "(a gem, crystal, reliquary, or some other ornamental container worth at least 500 gp)":"(драгоценный камень, кристалл, ковчег или другой декоративный контейнер стоимостью не менее 500 зм)",
    "(an iron blade and a small bag containing a mixture of soils-clay, loam, and sand)":"(железное лезвие и маленький мешочек со смесью почв — глина, суглинок и песок)",
    "(a bit of fleece and jade dust worth at least 25 gp)":"(кусочек овечьей шерсти и нефритовая пыль стоимостью не менее 25 зм)",
    "(a magnifying glass)":"(увеличительное стекло)",
    "(an ointment for the eyes that costs 25 gp; is made from mushroom powder, saffron, and fat; and is consumed by the spell)":"(мазь для глаз стоимостью 25 зм, изготовленная из грибного порошка, шафрана и жира, расходуемая заклинанием)",
    "(a small piece of quartz)":"(маленький кусочек кварца)",
    "(a handful of thorns)":"(горсть шипов)",
    "(fire and holy water)":"(огонь и святая вода)",
    "(a miniature platinum sword with a grip and pommel of copper and zinc, worth 250 gp)":"(миниатюрный платиновый меч с рукоятью и навершием из меди и цинка, стоимостью 250 зм)",
    "(ruby dust worth 1,500 gp)":"(рубиновая пыль стоимостью 1 500 зм)",
    "(a miniature portal carved from ivory, a small piece of polished marble, and a tiny silver spoon, each item worth at least 5 gp)":"(миниатюрный портал, вырезанный из слоновой кости, маленький кусочек полированного мрамора и крошечная серебряная ложечка, каждый предмет стоимостью не менее 5 зм)",
    "(a forked, metal rod worth at least 250 gp, attuned to a particular plane of existence)":"(раздвоенный металлический стержень стоимостью не менее 250 зм, настроенный на определённый план существования)",
    "(a small replica of you made from materials worth at least 5 gp)":"(маленькая копия вас, сделанная из материалов стоимостью не менее 5 зм)",
    "(a prayer wheel and holy water)":"(молитвенное колесо и святая вода)",
    "(a lodestone and iron filings)":"(магнитный камень и железные опилки)",
    "(a powder composed of diamond, emerald, ruby, and sapphire dust worth at least 5,000 gp, which the spell consumes)":"(порошок из алмазной, изумрудной, рубиновой и сапфировой пыли стоимостью не менее 5 000 зм, расходуемый заклинанием)",
    "(snow or ice in quantities sufficient to made a life-size copy of the duplicated creature; some hair, fingernail clippings, or other piece of that creature's body placed inside the snow or ice; and powdered ruby worth 1,500 gp, sprinkled over the duplicate and consumed by the spell)":"(снег или лёд в количестве, достаточном для создания копии дублируемого существа в натуральную величину; несколько волос, обрезков ногтей или другой части тела этого существа, помещённых внутрь снега или льда; и рубиновый порошок стоимостью 1 500 зм, посыпанный на дубликат и расходуемый заклинанием)",
    "(a pinch of powdered iron or iron filings)":"(щепотка железного порошка или железных опилок)",
    "(either a lump of alum soaked in vinegar for the *antipathy* effect or a drop of honey for the *sympathy* effect)":"(либо кусок квасцов, вымоченных в уксусе, для эффекта *антипатии*, либо капля мёда для эффекта *симпатии*)",
    "(a diamond worth at least 1,000 gp and at least 1 cubic inch of flesh of the creature that is to be cloned, which the spell consumes, and a vessel worth at least 2,000 gp that has a sealable lid and is large enough to hold a Medium creature, such as a huge urn, coffin, mud-filled cyst in the ground, or crystal container filled with salt water)":"(бриллиант стоимостью не менее 1 000 зм и не менее 1 кубического дюйма плоти существа, которое должно быть клонировано, расходуемые заклинанием, и сосуд стоимостью не менее 2 000 зм с запечатываемой крышкой, достаточно большой, чтобы вместить Среднее существо, например огромная урна, гроб, заполненная грязью яма в земле или хрустальный контейнер, наполненный солёной водой)",
    "(burning incense and bits of earth and wood mixed in water)":"(горящее благовоние и кусочки земли и дерева, смешанные с водой)",
    "(a pinch of dirt, a piece of rock, and a lump of clay)":"(щепотка грязи, кусочек камня и комок глины)",
    "(a handful of clay, crystal, glass, or mineral spheres)":"(горсть глиняных, хрустальных, стеклянных или минеральных сфер)",
    "(fire and a piece of sunstone)":"(огонь и кусочек солнечного камня)",
    "(for each creature you affect with this spell, you must provide one jacinth worth at least 1,000 gp and one ornately carved bar of silver worth at least 100 gp, all of which the spell consumes)":"(для каждого существа, на которое вы воздействуете этим заклинанием, вы должны предоставить один гиацинт стоимостью не менее 1 000 зм и один искусно вырезанный серебряный слиток стоимостью не менее 100 зм, всё это расходуется заклинанием)",
    "(a hummingbird feather)":"(перо колибри)",
    "(a diamond worth at least 5,000 gp)":"(бриллиант стоимостью не менее 5 000 зм)",
    "(a vellum depiction or a carved statuette in the likeness of the target, and a special component that varies according to the version of the spell you choose, worth at least 500 gp per Hit Die of the target)":"(пергаментное изображение или вырезанная статуэтка, похожая на цель, и особый компонент, зависящий от версии заклинания, стоимостью не менее 500 зм за каждую Кость Хитов цели)",
    "(a jade circlet worth at least 1,500 gp, which you must place on your head before you cast the spell)":"(нефритовый обруч стоимостью не менее 1 500 зм, который вы должны надеть на голову перед сотворением заклинания)",
    "(a drop of mercury, a dollop of gum arabic, and a wisp of smoke)":"(капля ртути, капля гуммиарабика и завиток дыма)",
    "(a sprinkle of holy water and diamonds worth at least 25,000 gp, which the spell consumes)":"(капля святой воды и бриллианты стоимостью не менее 25 000 зм, расходуемые заклинанием)",
    "(a diamond worth at least 1,000 gp, which the spell consumes)":"(бриллиант стоимостью не менее 1 000 зм, расходуемый заклинанием)",
}

LEVEL_HEADINGS = {
    "## Cantrips (Level 0)":"## Заговоры (уровень 0)",
    "## Level 1 Spells":"## Заклинания 1-го уровня",
    "## Level 2 Spells":"## Заклинания 2-го уровня",
    "## Level 3 Spells":"## Заклинания 3-го уровня",
    "## Level 4 Spells":"## Заклинания 4-го уровня",
    "## Level 5 Spells":"## Заклинания 5-го уровня",
    "## Level 6 Spells":"## Заклинания 6-го уровня",
    "## Level 7 Spells":"## Заклинания 7-го уровня",
    "## Level 8 Spells":"## Заклинания 8-го уровня",
    "## Level 9 Spells":"## Заклинания 9-го уровня",
}

def tr_school_line(line):
    m = re.match(r'^\*(Level (\d+) )?(\w+)( Cantrip)? \(([^)]+)\)\*\s*$', line)
    if not m: return line
    lvl = m.group(2); sch = m.group(3); cantrip = m.group(4); cls = m.group(5)
    sch_ru = SCH.get(sch, sch)
    cls_parts = [c.strip() for c in cls.split(",")]
    cls_ru = ", ".join(CN.get(c, c) for c in cls_parts)
    if cantrip:
        return f"*Заговор {SCH_GEN.get(sch_ru, sch_ru)} ({cls_ru})*"
    return f"*{sch_ru} {lvl}-го уровня ({cls_ru})*"

def tr_ct(rest):
    rest = rest.replace("Bonus Action", "Бонусное действие")
    rest = rest.replace("Action", "Действие")
    rest = rest.replace("Reaction", "Реакция")
    rest = rest.replace("or Ritual", "или Ритуал")
    rest = re.sub(r'(\d+) minutes?\b', lambda m: f"{m.group(1)} минута" if int(m.group(1))==1 else f"{m.group(1)} минут", rest)
    rest = re.sub(r'(\d+) hours?\b', lambda m: f"{m.group(1)} час" if int(m.group(1))==1 else f"{m.group(1)} часов" if int(m.group(1))>=5 else f"{m.group(1)} часа", rest)
    return rest

def tr_range(rest):
    rest = re.sub(r'Self \((\d+)-foot cone\)', lambda m: f'На себя ({m.group(1)}-футовый конус)', rest)
    rest = re.sub(r'Self \((\d+)-foot-radius sphere\)', lambda m: f'На себя (сфера радиусом {m.group(1)} футов)', rest)
    rest = re.sub(r'Self \((\d+)-foot radius\)', lambda m: f'На себя (радиус {m.group(1)} футов)', rest)
    rest = re.sub(r'Self \((\d+)-foot line\)', lambda m: f'На себя ({m.group(1)}-футовая линия)', rest)
    rest = re.sub(r'Self \((\d+)-foot-radius hemisphere\)', lambda m: f'На себя (полусфера радиусом {m.group(1)} футов)', rest)
    rest = re.sub(r'Self \((\d+)-foot cube\)', lambda m: f'На себя ({m.group(1)}-футовый куб)', rest)
    rest = rest.replace("Self", "На себя").replace("Touch", "Касание").replace("Unlimited", "Неограниченная").replace("Special", "Особая").replace("Sight", "Видимость")
    rest = re.sub(r'(\d+) feet\b', lambda m: f"{m.group(1)} футов", rest)
    rest = re.sub(r'(\d+)-foot\b', lambda m: f"{m.group(1)}-футов", rest)
    rest = re.sub(r'(\d+) miles?\b', lambda m: f"{m.group(1)} миль" if int(m.group(1))>=5 else f"{m.group(1)} мили" if int(m.group(1))>=2 else f"{m.group(1)} миля", rest)
    return rest

def tr_comp(rest):
    rest = re.sub(r'\bV\b', 'В', rest)
    rest = re.sub(r'\bS\b', 'С', rest)
    rest = re.sub(r'\bM\b', 'М', rest)
    for en, ru in MATS.items():
        if en in rest:
            rest = rest.replace(en, ru)
            break
    rest = re.sub(r'(\d[\d,]*) gp\b', lambda m: f"{m.group(1)} зм", rest)
    return rest

def tr_dur(text):
    text = text.replace("Instantaneous", "Мгновенная")
    text = text.replace("Concentration, up to ", "Концентрация, вплоть до ")
    text = text.replace("Up to ", "Вплоть до ")
    text = text.replace("Until dispelled or triggered", "Пока не будет рассеяно или активировано")
    text = text.replace("Until dispelled", "Пока не будет рассеяно")
    text = text.replace("Special", "Особая")
    text = text.replace("one minute", "1 минуту")
    text = text.replace("one hour", "1 час")
    def ru_min(m):
        n=int(m.group(1))
        if n==1: return f"{n} минуту"
        elif 2<=n<=4: return f"{n} минуты"
        else: return f"{n} минут"
    def ru_hr(m):
        n=int(m.group(1))
        if n==1: return f"{n} час"
        elif 2<=n<=4: return f"{n} часа"
        else: return f"{n} часов"
    def ru_rnd(m):
        n=int(m.group(1))
        if n==1: return f"{n} раунд"
        elif 2<=n<=4: return f"{n} раунда"
        else: return f"{n} раундов"
    def ru_day(m):
        n=int(m.group(1))
        if n==1: return f"{n} день"
        elif 2<=n<=4: return f"{n} дня"
        else: return f"{n} дней"
    text = re.sub(r'(\d+) minutes?\b', ru_min, text)
    text = re.sub(r'(\d+) hours?\b', ru_hr, text)
    text = re.sub(r'(\d+) rounds?\b', ru_rnd, text)
    text = re.sub(r'(\d+) days?\b', ru_day, text)
    return text

def tr_body(line):
    """Fallback body text translation from EN for lines not in LINE_MAP."""
    line = line.replace("**_At Higher Levels._**", "**_На более высоких уровнях._**")
    line = line.replace("**_Using a Higher-Level Spell Slot._**", "**_Использование ячейки более высокого уровня._**")
    line = line.replace("**_Cantrip Upgrade._**", "**_Усиление заговора._**")

    # Dice
    line = re.sub(r'(\d*)d(\d+)', lambda m: f"{m.group(1)}к{m.group(2)}", line)
    # Currency
    line = re.sub(r'(\d[\d,]*) gp\b', lambda m: f"{m.group(1)} зм", line)
    line = re.sub(r'(\d[\d,]*) sp\b', lambda m: f"{m.group(1)} см", line)
    line = re.sub(r'(\d[\d,]*) cp\b', lambda m: f"{m.group(1)} мм", line)
    # Level refs
    line = re.sub(r'\b(\d+)(?:st|nd|rd|th) level\b', lambda m: f"{m.group(1)}-го уровня", line)
    line = re.sub(r'\b(\d+)(?:st|nd|rd|th)-level\b', lambda m: f"{m.group(1)}-го уровня", line)
    # Feet
    line = re.sub(r'(\d+) feet\b', lambda m: f"{m.group(1)} футов", line)
    line = re.sub(r'(\d+)-foot\b', lambda m: f"{m.group(1)}-футов", line)
    line = re.sub(r'(\d+) foot\b', lambda m: f"{m.group(1)} фут", line)
    line = re.sub(r'(\d+) miles?\b', lambda m: f"{m.group(1)} миль" if int(m.group(1))>=5 else f"{m.group(1)} мили" if int(m.group(1))>=2 else f"{m.group(1)} миля", line)
    # Spell names in italics
    for en_n, ru_n in sorted(SN.items(), key=lambda x: -len(x[0])):
        line = re.sub(r'\*' + re.escape(en_n) + r'\*', f'*{ru_n}*', line)
    # Damage types
    for en, ru in [("acid damage","урон кислотой"),("bludgeoning damage","дробящий урон"),
                   ("cold damage","урон холодом"),("fire damage","урон огнём"),
                   ("force damage","урон силовым полем"),("lightning damage","урон электричеством"),
                   ("necrotic damage","некротический урон"),("piercing damage","колющий урон"),
                   ("poison damage","урон ядом"),("psychic damage","психический урон"),
                   ("radiant damage","урон излучением"),("slashing damage","рубящий урон"),
                   ("thunder damage","урон громом")]:
        line = line.replace(en, ru)
    # Saving throws
    for en, ru in [("Dexterity saving throw","спасбросок Ловкости"),
                   ("Constitution saving throw","спасбросок Телосложения"),
                   ("Wisdom saving throw","спасбросок Мудрости"),
                   ("Charisma saving throw","спасбросок Харизмы"),
                   ("Strength saving throw","спасбросок Силы"),
                   ("Intelligence saving throw","спасбросок Интеллекта"),
                   ("saving throw","спасбросок"),("saving throws","спасброски")]:
        line = line.replace(en, ru)
    # Common phrases
    line = line.replace("hit points", "хитов")
    line = line.replace("hit point", "хит")
    line = line.replace("attack roll", "бросок атаки")
    line = line.replace("spell save DC", "СЛ спасброска от ваших заклинаний")
    line = line.replace("Player's Handbook", "*Книга игрока*")
    return line

# Build output
out = list(ru_lines[:229])  # Keep intro (already translated)

for i in range(229, N):
    en = en_lines[i]

    if not en.strip():
        out.append(en); continue

    # Level section headings
    if en in LEVEL_HEADINGS:
        out.append(LEVEL_HEADINGS[en]); continue

    # Spell heading ### SpellName
    m = re.match(r'^(###) ([A-Z].+)$', en)
    if m:
        sn = m.group(2).strip()
        sr = SN.get(sn)
        if sr:
            out.append(f"### {sr} ({sn})")
        else:
            out.append(en)
        continue

    # School/level line
    if re.match(r'^\*(Level \d+ )?\w+( Cantrip)? \(', en):
        out.append(tr_school_line(en)); continue

    # Casting Time
    if en.startswith("**Casting Time:**"):
        rest = en[len("**Casting Time:**"):].strip()
        out.append(f"**Время накладывания:** {tr_ct(rest)}"); continue

    # Range
    if en.startswith("**Range:**"):
        rest = en[len("**Range:**"):].strip()
        out.append(f"**Дистанция:** {tr_range(rest)}"); continue

    # Components
    if en.startswith("**Components:**"):
        rest = en[len("**Components:**"):].strip()
        out.append(f"**Компоненты:** {tr_comp(rest)}"); continue

    # Duration
    if en.startswith("**Duration:**"):
        rest = en[len("**Duration:**"):].strip()
        out.append(f"**Длительность:** {tr_dur(rest)}"); continue

    # Check LINE_MAP first (manual translations)
    if i in LINE_MAP:
        out.append(LINE_MAP[i]); continue

    # Check LINE_MAP_EXT (extended manual translations)
    if i in LINE_MAP_EXT:
        out.append(LINE_MAP_EXT[i]); continue

    # Fallback: apply regex-based body translation
    out.append(tr_body(en))

# Verify
if len(out) != N:
    print(f"WARNING: Expected {N} lines, got {len(out)}", file=sys.stderr)
    while len(out) < N: out.append("")
    out = out[:N]

with open(RU_FILE, "w", encoding="utf-8") as f:
    f.write('\n'.join(out))

# Stats
manual_count = sum(1 for i in range(229, N) if i in LINE_MAP or i in LINE_MAP_EXT)
print(f"OK: {len(out)} lines written.")
print(f"Manual translations used: {manual_count}")
print(f"Lines with remaining English (fallback): {sum(1 for i in range(229, len(out)) if re.search(r'[A-Za-z]{3,}', out[i]) and not out[i].startswith('###') and not out[i].startswith('*') and not out[i].startswith('**'))}")
